{
  "hash": "d437f81a415041a5a5ff3981e42e38e6",
  "result": {
    "markdown": "---\ntitle: \"HiSat that SeaStar\"\ndescription: \"finally overcoming gtf h$11\"\ncategories: [hisat, seastar] # self-defined categories\n#citation: \ndate: 06-03-2024\nimage: http://gannet.fish.washington.edu/seashell/snaps/Monosnap_MultiQC_Report_2024-06-03_09-14-54.png # finding a good image\n\nauthor:\n  - name: Steven Roberts\n    url: \n    orcid: 0000-0001-8302-1138\n    affiliation: Professor, UW - School of Aquatic and Fishery Sciences\n    affiliation-url: https://robertslab.info\n  #url:  # self-defined\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\nformat:\n  html:\n    code-fold: FALSE\n    code-tools: true\n    code-copy: true\n    highlight-style: github\n    code-overflow: wrap\n---\n\n\n\n\nWhile there are still some questions related to overall alignment rates and sample specific alignment rates, it is possible that the mess of gtf might be overcome.\n\n![](http://gannet.fish.washington.edu/seashell/snaps/Monosnap_MultiQC_Report_2024-06-03_09-14-54.png)\n\nThe problem seemed to have arisen based on the fact NCBI renamed chromosomes whereas annotations (sitting on Dryad) have different IDs. Using a table on NCBI and realizing from author the numbers in their IDs corresponded to chromosome number.\n\n# Making a new GTF\n\nas there are quotes in original gtf I needed to add `quote = \"\"`\n\n````{{r}}\ngtfbttr <- read.table(\"../data/augustus.hints.gtf\", sep = \"\\t\", quote = \"\")\n````\n\nadded a new column with chromosome number\n\n````{{r}}\n\n````{{r}}\ngtfch <- gtfbttr %>%\n  mutate(Chromosome.name = str_extract(V1, \"(?<=\\\\.)\\\\d+\"),  # Extract the number after the dot\n         Chromosome.name = str_remove_all(Chromosome.name, \"^0+\"))  # Remove leading zeros\n\n````\n\nnow joining with NCBI table to get the GenBank.seq.accession\n\n````{{r}}\ngtfch %>%\nleft_join(ncbi, by = \"Chromosome.name\") %>%\nselect(GenBank.seq.accession, V2, V3, V4, V5, V6, V7, V8, V9) %>% filter(!is.na(GenBank.seq.accession)) %>%\nwrite.table(file = \"../analyses/12-fix-gff/mod_augustus.gtf\", sep = \"\\t\", quote = FALSE, row.names = FALSE, col.names = FALSE)\n````\n\nthis new gtf is in rpos and can be found [here](https://gannet.fish.washington.edu/seashell/bu-github/paper-pycno-sswd-2021-2022/analyses/12-fix-gff/mod_augustus.gtf)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nhead ../analyses/12-fix-gff/mod_augustus.gtf\n```\n:::\n\n\n# Reads\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nls /home/shared/8TB_HDD_02/graceac9/data/pycno2021/*\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\n/home/shared/FastQC-0.12.1/fastqc \\\n/home/shared/8TB_HDD_02/graceac9/data/pycno2021/*fq.gz \\\n-t 36 \\\n-o ../analyses/13-hisat-deseq2/\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\neval \"$(/opt/anaconda/anaconda3/bin/conda shell.bash hook)\"\nconda activate\nwhich multiqc\n\n\nmultiqc ../analyses/13-hisat-deseq2/ \\\n-o ../analyses/13-hisat-deseq2/\n```\n:::\n\n\n# Genome\n\n<https://www.ncbi.nlm.nih.gov/datasets/genome/GCA_032158295.1/>\n\n![](http://gannet.fish.washington.edu/seashell/snaps/Monosnap_Pycnopodia_helianthoides_genome_assembly_ASM3215829v1_-_NCBI_-_NLM_2024-05-25_15-32-13.png)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\ncd ../data\n\n/home/shared/datasets download genome accession GCA_032158295.1 --include gff3,rna,cds,protein,genome,seq-report\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\ncd ../data \nunzip ncbi_dataset.zip\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nls ../data/ncbi_dataset/data/GCA_032158295.1\n\n```\n:::\n\n\n## Annotation files\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nhead ../analyses/12-fix-gff/mod_augustus.gtf\nhead ../data/ncbi_dataset/data/GCA_032158295.1/GCA_032158295.1_ASM3215829v1_genomic.fna\n```\n:::\n\n\n# Hisat\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\n/home/shared/hisat2-2.2.1/hisat2_extract_exons.py \\\n../analyses/12-fix-gff/mod_augustus.gtf \\\n> ../analyses/13-hisat-deseq2/m_exon.tab\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\n/home/shared/hisat2-2.2.1/hisat2_extract_splice_sites.py \\\n../analyses/12-fix-gff/mod_augustus.gtf \\\n> ../analyses/13-hisat-deseq2/m_spice_sites.tab\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\necho \"13-hisat-deseq2/GCF*\" >> ../analyses/.gitignore\necho \"13-hisat-deseq2/GCF**fastq\" >> ../analyses/.gitignore\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\n/home/shared/hisat2-2.2.1/hisat2-build \\\n../data/ncbi_dataset/data/GCA_032158295.1/GCA_032158295.1_ASM3215829v1_genomic.fna \\\n../analyses/13-hisat-deseq2/GCA_032158295.index \\\n--exon ../analyses/13-hisat-deseq2/m_exon.tab \\\n--ss ../analyses/13-hisat-deseq2/m_spice_sites.tab \\\n-p 20 \\\n../analyses/12-fix-gff/mod_augustus.gtf \\\n2> ../analyses/13-hisat-deseq2/hisat2-build_stats.txt\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\necho \"13-hisat-deseq2/*sam\" >> ../analyses/.gitignore\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nfind /home/shared/8TB_HDD_02/graceac9/data/pycno2021/*_R1_001.fastq.gz.fastp-trim.20220810.fq.gz | xargs basename -s _R1_001.fastq.gz.fastp-trim.20220810.fq.gz | xargs -I{} echo {}\n```\n:::\n\n\nkeeping unmapped reads\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nfind /home/shared/8TB_HDD_02/graceac9/data/pycno2021/*_R1_001.fastq.gz.fastp-trim.20220810.fq.gz \\\n| xargs -I{} basename -s _R1_001.fastq.gz.fastp-trim.20220810.fq.gz {} \\\n| xargs -I{} sh -c '/home/shared/hisat2-2.2.1/hisat2 \\\n-x ../analyses/13-hisat-deseq2/GCA_032158295.index \\\n--dta \\\n-p 32 \\\n-1 /home/shared/8TB_HDD_02/graceac9/data/pycno2021/{}_R1_001.fastq.gz.fastp-trim.20220810.fq.gz \\\n-2 /home/shared/8TB_HDD_02/graceac9/data/pycno2021/{}_R2_001.fastq.gz.fastp-trim.20220810.fq.gz \\\n-S ../analyses/13-hisat-deseq2/{}_03.sam \\\n--un-conc ../analyses/13-hisat-deseq2/{}_unmapped_reads.fastq \\\n> ../analyses/13-hisat-deseq2/{}_hisat03.stdout 2> ../analyses/13-hisat-deseq2/{}_hisat03.stderr'\n```\n:::\n\n\nExplanation xargs -I{}: This option allows you to replace {} in the command with the output from the previous command (i.e., basename).\nIt's used twice: first, to strip the suffix from the filenames, and second, to construct and execute the hisat2 command.\n\nsh -c: This is used to execute a complex command within xargs.\nIt's necessary because the output redirection (\\>, 2\\>) is shell functionality, and without sh -c, xargs wouldn't handle it correctly.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\necho \"13-hisat-deseq2/*bam\" >> ../analyses/.gitignore\necho \"13-hisat-deseq2/*bam*\" >> ../analyses/.gitignore\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nfor samfile in ../analyses/13-hisat-deseq2/*.sam; do\n  bamfile=\"${samfile%.sam}.bam\"\n  sorted_bamfile=\"${samfile%.sam}.sorted.bam\"\n  /home/shared/samtools-1.12/samtools view -bS -@ 20 \"$samfile\" > \"$bamfile\"\n  /home/shared/samtools-1.12/samtools sort -@ 20 \"$bamfile\" -o \"$sorted_bamfile\"\n  /home/shared/samtools-1.12/samtools index -@ 20 \"$sorted_bamfile\"\ndone\n```\n:::\n\n\n,\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nrm ../analyses/13-hisat-deseq2/*sam\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nls ../analyses/13-hisat-deseq2/*sorted.bam | wc -l\n```\n:::\n\n\n# Stringtie\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\necho \"13-hisat-deseq2/*gtf\" >> ../analyses/.gitignore\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\n/home/shared/gffread-0.12.7.Linux_x86_64/gffread \\\n../analyses/12-fix-gff/mod_augustus.gtf \\\n-T \\\n-o ../analyses/13-hisat-deseq2/mod_augustus.gff\n\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\nfind ../analyses/13-hisat-deseq2/*sorted.bam \\\n| xargs basename -s .sorted.bam | xargs -I{} \\\nsh -c '/home/shared/stringtie-2.2.1.Linux_x86_64/stringtie \\\n-p 36 \\\n-eB \\\n-G ../analyses/13-hisat-deseq2/mod_augustus.gff \\\n-o ../analyses/13-hisat-deseq2/{}.gtf \\\n../analyses/13-hisat-deseq2/{}.sorted.bam'\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.bash .cell-code}\neval \"$(/opt/anaconda/anaconda3/bin/conda shell.bash hook)\"\nconda activate\nwhich multiqc\n\n\nmultiqc ../analyses/13-hisat-deseq2/ \\\n-o ../analyses/13-hisat-deseq2/\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
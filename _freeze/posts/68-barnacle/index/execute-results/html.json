{
  "hash": "b3b4689206f883c6ba0a16728614108f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Barnacle\"\ndescription: \"more lamda values\"\ncategories: [e5, coral]\n#citation: \ndate: 12-04-2025\nimage: http://gannet.fish.washington.edu/seashell/snaps/Monosnap_Image_2025-11-30_15-34-25.png # finding a good image\nauthor:\n  - name: Steven Roberts\n    url: \n    orcid: 0000-0001-8302-1138\n    affiliation: Professor, UW - School of Aquatic and Fishery Sciences\n    affiliation-url: https://robertslab.info\n  #url:  # self-defined\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\nformat:\n  html:\n    toc: true            # ← enable TOC\n    toc-location: left   # or: right, body\n    toc-depth: 3         # how many heading levels to show\n    code-fold: FALSE\n    code-tools: true\n    code-copy: true\n    highlight-style: github\n    code-overflow: wrap\n#runtime: shiny\n---\n\n# More lamda testing\n\n``` bash\nLAMBDAS_GENE=\"1 2 4 6 8 10\"\nLAMBDA_SAMPLE=0.1\nLAMBDA_TIME=0.05\nRANK=35\n\nmkdir -p ../output/41-rank35-optimization\n\nOUTDIR_BASE=../output/41-rank35-optimization\n\nfor LG in $LAMBDAS_GENE; do\n  OUTDIR=${OUTDIR_BASE}/lambda_gene_${LG}\n  mkdir -p \"$OUTDIR\"\n\n  uv run python ../scripts/14.1-barnacle/build_tensor_and_run.py \\\n    --input-file ../output/14-pca-orthologs/vst_counts_matrix.csv \\\n    --output-dir \"$OUTDIR\" \\\n    --rank $RANK \\\n    --lambda-gene $LG \\\n    --lambda-sample $LAMBDA_SAMPLE \\\n    --lambda-time $LAMBDA_TIME \\\n    --max-iter 1000 \\\n    --tol 1e-5 \\\n    --seed 92\ndone\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\n# ---------------------------------------------------------\n# SETTINGS\n# ---------------------------------------------------------\n\nbase_url <- \"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization\"\n\nlambda_vals <- c(\"1\", \"2\", \"4\", \"6\", \"8\", \"10\")\n\n# ---------------------------------------------------------\n# FUNCTION: read gene_factors.csv AND FIX HEADER\n# ---------------------------------------------------------\nread_gene_factors <- function(lambda) {\n  url <- sprintf(\"%s/lambda_gene_%s/barnacle_factors/gene_factors.csv\",\n                 base_url, lambda)\n\n  message(\"Reading: \", url)\n  df <- read_csv(url, show_col_types = FALSE)\n\n  # Fix the shifted header here\n  # First column should be \"gene\", others \"comp1..compN\"\n  colnames(df) <- c(\"gene\", paste0(\"comp\", 1:(ncol(df)-1)))\n\n  df$lambda_gene <- lambda\n  df\n}\n\n# ---------------------------------------------------------\n# READ ALL RUNS\n# ---------------------------------------------------------\nall_factors <- map_df(lambda_vals, read_gene_factors)\n\n# ---------------------------------------------------------\n# LONG FORMAT FOR ANALYSIS\n# ---------------------------------------------------------\nfactor_long <- all_factors %>%\n  pivot_longer(\n    cols = starts_with(\"comp\"),\n    names_to = \"component\",\n    values_to = \"loading\"\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsparsity_tbl <- factor_long %>%\n  group_by(lambda_gene) %>%\n  summarize(\n    n_values = n(),\n    n_zero = sum(loading == 0 | abs(loading) < 1e-12),\n    sparsity = n_zero / n_values\n  )\n\nsparsity_tbl \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 4\n  lambda_gene n_values n_zero sparsity\n  <chr>          <int>  <int>    <dbl>\n1 1             343000   3079  0.00898\n2 10            343000  25244  0.0736 \n3 2             343000   3798  0.0111 \n4 4             343000   7023  0.0205 \n5 6             343000  16289  0.0475 \n6 8             343000  21282  0.0620 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngene_component_counts <- factor_long %>%\n  filter(loading > 0) %>%\n  group_by(lambda_gene, gene) %>%\n  summarize(\n    n_components = n_distinct(component),\n    .groups = \"drop\"\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmulti_component_summary <- gene_component_counts %>%\n  group_by(lambda_gene, n_components) %>%\n  summarize(n_genes = n(), .groups = \"drop\")\n\nmulti_component_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 59 × 3\n   lambda_gene n_components n_genes\n   <chr>              <int>   <int>\n 1 1                     27       2\n 2 1                     28       3\n 3 1                     29       5\n 4 1                     30      17\n 5 1                     31      54\n 6 1                     32     127\n 7 1                     33     402\n 8 1                     34    1526\n 9 1                     35    7664\n10 10                    24       3\n# ℹ 49 more rows\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary_tbl <- sparsity_tbl %>%\n  left_join(\n    gene_component_counts %>%\n      group_by(lambda_gene) %>%\n      summarize(\n        mean_components = mean(n_components),\n        frac_multi = mean(n_components > 1),\n        .groups = \"drop\"\n      ),\n    by = \"lambda_gene\"\n  )\n\nsummary_tbl\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  lambda_gene n_values n_zero sparsity mean_components frac_multi\n  <chr>          <int>  <int>    <dbl>           <dbl>      <dbl>\n1 1             343000   3079  0.00898            34.7          1\n2 10            343000  25244  0.0736             32.4          1\n3 2             343000   3798  0.0111             34.6          1\n4 4             343000   7023  0.0205             34.3          1\n5 6             343000  16289  0.0475             33.3          1\n6 8             343000  21282  0.0620             32.8          1\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # Load data\n  gene_factors <- read_csv(\"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization/lambda_gene_1/barnacle_factors/gene_factors.csv\")\n\n\n#edit so columns names are shifted 1 to the left\n  colnames(gene_factors) <- c(\"gene\", paste0(\"comp\", 1:(ncol(gene_factors)-1)))\n\n#code to create histogram of gene_factors:\n  \n  library(ggplot2)\n  library(tidyr)\n  \n  # Reshape data to long format \n  gene_factors_long <- gene_factors %>%\n    pivot_longer(cols = -1, names_to = \"component\", values_to = \"loading\")\n  \n  # Plot histogram\n  ggplot(gene_factors_long, aes(x = loading)) +\n    geom_histogram(bins = 50, fill = \"blue\", alpha = 0.7) +\n    facet_wrap(~ component, scales = \"free\") +\n    theme_minimal() +\n    labs(title = \"Distribution of Gene Loadings for Rank 35 Components\",\n         x = \"Gene Loading\",\n         y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # Load data\n  gene_factors <- read_csv(\"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization/lambda_gene_2/barnacle_factors/gene_factors.csv\")\n\n\n#edit so columns names are shifted 1 to the left\n  colnames(gene_factors) <- c(\"gene\", paste0(\"comp\", 1:(ncol(gene_factors)-1)))\n\n#code to create histogram of gene_factors:\n  \n  library(ggplot2)\n  library(tidyr)\n  \n  # Reshape data to long format \n  gene_factors_long <- gene_factors %>%\n    pivot_longer(cols = -1, names_to = \"component\", values_to = \"loading\")\n  \n  # Plot histogram\n  ggplot(gene_factors_long, aes(x = loading)) +\n    geom_histogram(bins = 50, fill = \"blue\", alpha = 0.7) +\n    facet_wrap(~ component, scales = \"free\") +\n    theme_minimal() +\n    labs(title = \"Distribution of Gene Loadings for Rank 35 Components\",\n         x = \"Gene Loading\",\n         y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # Load data\n  gene_factors <- read_csv(\"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization/lambda_gene_4/barnacle_factors/gene_factors.csv\")\n\n\n#edit so columns names are shifted 1 to the left\n  colnames(gene_factors) <- c(\"gene\", paste0(\"comp\", 1:(ncol(gene_factors)-1)))\n\n#code to create histogram of gene_factors:\n  \n  library(ggplot2)\n  library(tidyr)\n  \n  # Reshape data to long format \n  gene_factors_long <- gene_factors %>%\n    pivot_longer(cols = -1, names_to = \"component\", values_to = \"loading\")\n  \n  # Plot histogram\n  ggplot(gene_factors_long, aes(x = loading)) +\n    geom_histogram(bins = 50, fill = \"blue\", alpha = 0.7) +\n    facet_wrap(~ component, scales = \"free\") +\n    theme_minimal() +\n    labs(title = \"Distribution of Gene Loadings for Rank 35 Components\",\n         x = \"Gene Loading\",\n         y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # Load data\n  gene_factors <- read_csv(\"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization/lambda_gene_6/barnacle_factors/gene_factors.csv\")\n\n\n#edit so columns names are shifted 1 to the left\n  colnames(gene_factors) <- c(\"gene\", paste0(\"comp\", 1:(ncol(gene_factors)-1)))\n\n#code to create histogram of gene_factors:\n  \n  library(ggplot2)\n  library(tidyr)\n  \n  # Reshape data to long format \n  gene_factors_long <- gene_factors %>%\n    pivot_longer(cols = -1, names_to = \"component\", values_to = \"loading\")\n  \n  # Plot histogram\n  ggplot(gene_factors_long, aes(x = loading)) +\n    geom_histogram(bins = 50, fill = \"blue\", alpha = 0.7) +\n    facet_wrap(~ component, scales = \"free\") +\n    theme_minimal() +\n    labs(title = \"Distribution of Gene Loadings for Rank 35 Components\",\n         x = \"Gene Loading\",\n         y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # Load data\n  gene_factors <- read_csv(\"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization/lambda_gene_8/barnacle_factors/gene_factors.csv\")\n\n\n#edit so columns names are shifted 1 to the left\n  colnames(gene_factors) <- c(\"gene\", paste0(\"comp\", 1:(ncol(gene_factors)-1)))\n\n#code to create histogram of gene_factors:\n  \n  library(ggplot2)\n  library(tidyr)\n  \n  # Reshape data to long format \n  gene_factors_long <- gene_factors %>%\n    pivot_longer(cols = -1, names_to = \"component\", values_to = \"loading\")\n  \n  # Plot histogram\n  ggplot(gene_factors_long, aes(x = loading)) +\n    geom_histogram(bins = 50, fill = \"blue\", alpha = 0.7) +\n    facet_wrap(~ component, scales = \"free\") +\n    theme_minimal() +\n    labs(title = \"Distribution of Gene Loadings for Rank 35 Components\",\n         x = \"Gene Loading\",\n         y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n  # Load data\n  gene_factors <- read_csv(\"https://gannet.fish.washington.edu/v1_web/owlshell/bu-github/timeseries_molecular/M-multi-species/output/41-rank35-optimization/lambda_gene_10/barnacle_factors/gene_factors.csv\")\n\n\n#edit so columns names are shifted 1 to the left\n  colnames(gene_factors) <- c(\"gene\", paste0(\"comp\", 1:(ncol(gene_factors)-1)))\n\n#code to create histogram of gene_factors:\n  \n  library(ggplot2)\n  library(tidyr)\n  \n  # Reshape data to long format \n  gene_factors_long <- gene_factors %>%\n    pivot_longer(cols = -1, names_to = \"component\", values_to = \"loading\")\n  \n  # Plot histogram\n  ggplot(gene_factors_long, aes(x = loading)) +\n    geom_histogram(bins = 50, fill = \"blue\", alpha = 0.7) +\n    facet_wrap(~ component, scales = \"free\") +\n    theme_minimal() +\n    labs(title = \"Distribution of Gene Loadings for Rank 35 Components\",\n         x = \"Gene Loading\",\n         y = \"Count\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}